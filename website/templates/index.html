<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Voting 2025</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold"> Voting 2025</h1>
            <p>üìû +92-300-1234567 | ‚úâÔ∏è azka.voting@gmail.com</p>
        </div>
        <div id="clock" class="text-lg font-mono"></div>
    </header>

    <!-- Pre-voting display -->
    <div id="preVoting" class="text-center mt-10">
        <h2 class="text-2xl font-bold">Voting starts at 10:00 AM PST</h2>
        <p class="mt-4">Location: Voting Portal</p>
    </div>

    <!-- Live voting display -->
    <div id="liveVoting" class="mt-10 px-10" style="display:none;">
        <h2 class="text-2xl font-bold text-center mb-6">Live Vote Count</h2>
        <p class="text-center text-3xl font-bold">Total Votes: <span id="vote-count">0</span></p>

        <!-- Verify Vote Button -->
        <div class="flex justify-center mt-6">
            <a href="{{ url_for('verify_vote') }}"
               class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
               Verify Vote
            </a>
        </div>
    </div>

    <script>
        const votingHour = 10;
        const votingMinute = 0;

        // Update the clock and toggle pre-voting/live-voting sections
        function updateClockAndVoting() {
            const now = new Date();
            const options = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-US', options);

            const votingStarted = (now.getHours() > votingHour) || 
                                  (now.getHours() === votingHour && now.getMinutes() >= votingMinute);

            document.getElementById('preVoting').style.display = votingStarted ? 'none' : 'block';
            document.getElementById('liveVoting').style.display = votingStarted ? 'block' : 'none';
        }

        // Fetch votes from API and update the vote count
        async function loadVotes() {
            try {
                const response = await fetch("/api/live_votes");
                if (!response.ok) {
                    console.error("HTTP error:", response.status);
                    return;
                }
                const data = await response.json();
                document.getElementById("vote-count").textContent = data.total_votes_cast;
            } catch (err) {
                console.error("Error fetching live votes:", err);
            }
        }

        // Initialize clock and live votes update
        function initDashboard() {
            updateClockAndVoting();
            loadVotes(); // Initial load
            setInterval(() => {
                updateClockAndVoting();
                loadVotes();
            }, 5000); // Refresh every 5 seconds
        }

        window.onload = initDashboard;
    </script>

</body>
</html>
